---
title: 第七单元 数据库设计
date: 2019-09-9 15:03:10
categories: 幽邃研路
tags: [考研,人大855,数据库]
---
### 7.1 数据库设计概述
数据库设计，狭义上的讲，**是设计数据库本身，即设计数据库的各级模式并建立数据库，这是数据库应用系统设计的一部分**  

数据库设计的一般定义：**对于一个给定应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效的存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求**  
信息管理需求：在数据库中应该存储和管理哪些对象。  
数据操作需求：对于数据对象应该进行那些操作  
<!--more--> 
数据库设计的目标：为用户和各种应用系统提供一个信息基础设施和高效的运行环境
#### 7.1.1 数据库设计的特点
数据库建设：DBMS从设计、实施到运行与维护的全过程   
##### 1. 数据库建设的基本规律
**三分技术、七分管理、十二分基础数据**  

数据库建设中，管理更加重要。
管理分为：  
1. 数据库应用系统的项目管理
2. 企业的业务管理：更加重要，对数据库结构的设计有直接影响  
（数据库结构是对于企业的业务部门的数据以及个业务部门之间的数据联系的描述和抽象，而业务部门数据和个业务部门之间的联系是由企业管理所决定的）  

**十二分基础数据**强调了数据的收集、整理、组织和不断更新是数据库建设中的重要环节  
##### 2. 结构（数据）设计和行为（处理）设计相结合
数据库设计应该和应用系统设计相结合，也就是说，整个设计过程要把数据库结构设计和对数据的处理涉及密切结合起来。
#### 7.1.2 数据库设计方法
早期：手工和经验相结合，缺乏科学理论和工程方法的支持，设计质量难以保证  
#### 7.1.3 数据库设计的基本步骤
分为**6**个阶段  

1. 需求分析阶段：最困难和最耗时间的一步
2. 概念结构设计阶段：对用户需求进行总和，归纳，和抽象，形成1个和独立于具体DBMS的概念模型
3. 逻辑结构设计：将概念结构转换为某个DBMS所支持的数据模型，并对其进行优化
4. 物理结构设计：为逻辑数据模型选取一个最适合应用环境的物理结构（包括存储结构和存取方法）
5. 数据库实施阶段
6. 数据库运行和维护阶段

（需求分析和概念结构设计可以独立于任何DBMS进行，逻辑结构设计和物理结构设计与选用的DBMS密切相关）  

#### 7.1.4 数据库设计中的各级模式
1. 该今年结构设计阶段-->概念模式（E-R图）
2. 逻辑设计阶段-->数据模型于外模式
3. 物理结构设计-->内模式

### 7.2 需求分析
#### 7.2.1 需求分析的任务
任务：详细调查现实世界要处理的对象，充分了解原系统的工作概况，明确用户的各种需求，在此基础上确定系系统的功能  
**调查的重点时数据和处理，通过调查、收集和分析，获得用户对数据库的如下要求**  
1. 信息要求
    - 指用户需要从数据库中获得信息的内容和性质。
    - 由信息要求可以推导出数据要求，即数据库中需要存储那些数据
2. 处理要求
    - 用户要完成的数据处理功能，对处理性能的要求
3. 安全性与完整性要求

#### 7.2.2 需求分析的方法
**调查用户需求的具体步骤是：**  
1. 调查组织机构情况
2. 调查各部门的业务活动情况
3. 在熟悉业务活动的基础之上，协助用户明确对于新系统的各种要求，包括信息要求，处理要求，安全性和完整性的要求
4. 确定新系统的边界：即对之前调查的结果进行初步分析，确定哪些是计算机完成的功能，哪些是人工完成的功能

**常用的调查方法**：  
1. 跟班作业
2. 开调查会
3. 请专人介绍
4. 想你问
5. 设计调查表请用户填写
6. 查阅记录

#### 7.2.3 数据字典 
**数据字典是关于数据库中数据的描述，即元数据，而不是数据本身。数据字典是在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善的。它在数据库设计中占有很重要的地位**  

内容：数据字典包括数据项，数据结构，数据流，数据存储和处理过程这几部分。数据项是最小组成单位，多个数据项组成数据结构，对数据项和数据结构的定义组成数据流，数据存储的逻辑内容  

##### 1. 数据项
内容：数据项描述={数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其他数据项的逻辑关系，数据项之间的联系}

说明：取值范围+与其他数据项之间的逻辑关系=数据的完整性约束条件数据项之间的联系->逻辑设计阶段数据模型优化的依据  

##### 2. 数据结构
数据结构反映了数据之间的组合关系，它可以由数据项与（或）数据结构组合而成  

内容：数据结构描述={数据结构描述，含义说明，组成：{数据项或数据结构}}  

##### 3. 数据流
数据流是数据结构在系统内传输的路径  
内容：数据流描述={数据流名，说明，数据流来源，数据流去向，组成：{数据结构}，平均流量，高峰期流量}  
说明：  
1. 数据流来源：数据流来自那个过程
2. 数据流去向：数据流前往那个过程
3. 平均流量：单位时间内的传输次数
4. 高峰期流量：高峰时期的数据流量

##### 4. 数据存储
数据存储是数据结构停留或者保存的地方，也是数据流的来源或者去向之一  
内容：数据存储描述={数据存储名，说明，编号，输入的数据流，输出的数据流，组成：{数据结构}，数据量，存取频度，存取方式}
说明：  
1. 输入的数据流：要指出来源
2. 输出的数据流：要指出去向
3. 存取频度：每小时/天/周的存取次数和每次存取的数据量  
4. 存取方式：批处理还是练级处理，检索还是更新，顺序检索还是随机检索

##### 5. 处理过程
处理过程的具体处理逻辑一般用判定表或者判定树来描述，数据字典中只需要描述处理过程的说明性信息即可  
内容：处理过程描述={处理过程名，说明，输入：{数据流}，输出：{数据流}，处理：{简要说明}}  
说明：  
1. 简要说明中只需要说明处理过程的功能以及处理要求

### 7.3 概念结构设计
#### 7.3.1 概念模型
**特点：**  
1. 能真实、充分的反映现实世界，包括事物和事物之间的联系，能够满足用户的数据的处理要求，是先现实世界的一个真实模型  
2. 义域理解，可以用它和不熟悉计算机的用户交换意见
3. 易于更改，当应用环境和应用要求改变时容易对概念模型修改和扩充
4. 易于向关系、网状、层次等各种数据模型转换

与数据模型的不同：概念模型是各种数据模型的基础，比数据模型更独立于机器，更抽象，从而更加稳定  

#### 7.3.2 E-R模型
**E-R模型是用E-R图来描述现实世界的概念模型**  
E-R模型设计的主要概念包括**实体、属性、实体间的联系等**  
##### 1. 实体间的联系
1. **两个实体型之间的联系**
    1. 一对一（0~1）
    2. 一对多（0~n）
    3. 多对多（0~m, 0~n）
2. **两个以上的实体型之间的联系**  
仍然分为如上所述的三类
3. **单个实体型内的联系**  
同上

一般，把参与联系的实体型称为联系的度，联系也由此分为二元联系，三元联系...n元联系  
##### 2. E-R图
**E-R图提供了表示实体型，属性和联系的方法**  
实体型-->矩形  
属性-->椭圆形  
联系-->菱形  

**画E-R图的时候不要在联系中画外键**  

##### 7.3.5 概念结构设计
概念结构设计的第一步就是对于需求分析阶段收集到的数据进行分类，组织，确定实体、实体的属性、实体之间的联系类型，形成E-R图
###### 1. 实体和属性的划分原则
**为了简化E-R图的处置，现实世界的事物能作为属性对待的尽量作为属性对待**  

属性判断准则：  
1. **作为属性，不能再具有需要描述的性质**
2. **属性不能与其他实体具有联系**

###### 2. E-R图的集成
开发大型系统时，常常先设计各个子系统的E-R图，然后把它们集成起来  
集成步骤：  
1. 合并：解决各个分E-R图的冲突，生成初步E-R图
2. 修改和重构：消除不必要的冗余，生成基本E-R图

各个子系统的E-R图之间的冲突主要有三类：**属性冲突**，**命名冲突**和**结构冲突**  
1. 属性冲突  
    - 属性域冲突：同一属性的类型、取值范围或取值集合不同
    - 属性取值单位冲突：如斤、公斤、千克
2. 命名冲突
    - 同名异议
    - 异名同义  
可以发生在实体、联系一级上，也可以发生在属性一级上  
3. 结构冲突
    - 同一对象在不同应用中具有不同的抽象
        - 说明：如职工在一个图里是实体，在另一个图里是属性
        - 解决方案：把属性变换为实体或把实体变换为属性，使得同一对象具有相同的抽象
    - 同一实体在不同子系统的E-R图中所包含的属性个数和属性的排列次序不完全相同
        - 解决方案：把该实体的属性取各个子系统内E-R图中属性的并集，在适当调整属性的次序
    - 实体间的联系在不同的E-R图中为不同的类型
        - 说明：如这里一对一，那里一对多，这里二元联系，那里三元联系  

消除不必要的冗余，从而生成基本E-R图：  
**在初步E-R图中可能存在一些冗余的数据和实体间冗余的联系**  
冗余：可由基本的数据或者基本的联系所导出  
初步E-R图 - 冗余 = 基本E-R图  

###### 消除冗余
- 分析方法
    - 以数据字典和数据流图为依据，根据数据字典中关于数据项之间的逻辑关系的说明来消除冗余  
    - 并不是所有的冗余都必须要消除，有时会保留一些冗余。此时要把数据字典中数据关联的说明作为完整性约束条件  
- 规范化理论
    - 函数依赖的概念提供了消除冗余联系的形式化工具
    - 步骤
        1. 确定分E-R图中实体之间的数据依赖。（将一对一，一对多，多对多的联系用实体码之间的函数依赖来表示），获得一个函数依赖集
        2. 求函数依赖记得最小覆盖，获得差集，逐一考察差集中的函数依赖
    - 注意：
        1. 冗余的联系一定在差集中，但是差集中的联系并不全是冗余的
        2. 当实体之间存在多种联系时，要将实体之间的联系在形式上加以区分（就是一对一的联系要写成两个）  

### 7.4 逻辑结构设计
**逻辑结构设计的任务就是把概念结构设计阶段设计好的基本E-R图转换为与选用DBMS产品所支持的数据模型相符合的数据结构**    
#### 7.4.1 E-R图向关系模型的转换
面临问题：如何将实体型和实体之间的联系转换为关系模式，如何确定这些关系模式的属性和码  
转换的一般原则：**一个实体型转换为一个关系模式**，关系的属性就是实体的属性，关系的码就是实体的码  
对于实体间的联系：  
1. 一个1：1联系可以转换为一个独立关系模式，也可以与任意一端所对应的关系模式合并
    - 如果转换成了一个独立的关系模式，两端实体的码作为其候选码
2. 一个1：n联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并
    - 如果转换成了一个独立的关系模式，则关系的码是n端实体的码
3. 一个m:n联系转换为一个关系模式
    - 各实体的码组成关系的码或者关系码的一部分
4. 三个或三个以上实体间的一个多元联系可以转换为一个关系模式
    - 各实体的码组成关系的码或者关系码的一部分
5. 具有相同码的关系模式可以合并

#### 7.4.2 数据模型的优化
**数据库逻辑设计的结果并不是唯一的**  
关系数据模型的优化以规范化理论为指导，方法为  
1. 确定数据依赖
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系
3. 按照数据依赖的理论对关系模式逐一进行分析，考察是否存在部分函数依赖、传递函数依赖，多值依赖等。确定各关系模式分别属于第几范式  
4. 根据需求分析阶段得到的处理要求，分析这样的应用环境，这些模式是否合适，确定是否要对某些模式进行合并或分解  
    - **并不是规范化越高的关系就越优**  
对于一个具体应用来说，到底规范化到什么程度需要权衡响应时间和潜在问题两者的利弊决定  
5. 对于关系模式进行必要分解，提高数据操作效率和存储时间利用率。常用的两种分解方法是水平分解和垂直分解  
    - 水平分解
        - 概念：把基本关系的元组分为若干自己和，定义每个自己合为一个子关系，以提高系统的效率  
        - 比如把经常使用的数据分解出来，或者一个关系上定义了n个事务，多数事务之间存取的数据并不相交，则R可以分解为<=n个子关系
    - 垂直分解
        - 概念：把关系模式R的属性分解为若干子集合，形成若干子关系模式。
        - 原则：将经常在一起使用的属性从R中分解出来形成一个子关系模式
        - 依据：分解后R上所有事务的总效率是否得到了提高
        - 限制：垂直分解需要确保无损连接性和保持函数依赖
#### 7.4.3 设计用户子模式
将概念模型转换为全局逻辑模型之后，还应该设计用户的外模式    
通常利用视图功能  

定义用户外模式时可以注重考虑用户的习惯与方便，包括：  
1. 使用更符合用户习惯的别名
    - 在设计用户视图时可以重新定义某些属性名，使其与用户的使用习惯一致
2. 对不同级别的用户定义不同的视图，以保证系统的安全性
3. 简化用户对系统的使用
    - 将一些很复杂的查询封装为视图，方便用户使用

### 7.5 物理结构设计
物理结构：数据库在物理设备上的存储结构和存取方法  
**物理结构设计：为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程**    
设计步骤：  
1. **确定数据库的物理结构**
2. **对物理结构进行评价**
    - 评价的重点主要是时间和空间效率  
#### 7.5.1 数据库物理设计的内容和方法
**内容：为关系模式选择存取方法，设计关系、索引等数据库文件的物理存储结构**  
#### 7.5.2 关系模式存取方法选择
对与同一关系要建立多条存取路径，物理设计任务之一就是根据DBMS支持的存取方法确定选择那些存取方法  
**常用的存取方法为索引方法和聚簇方法**  
##### 1. B+树索引存取方法的选择
选择索引存取方法，就是在哪些属性列建立索引，那些属性列建立组合索引，那些属性列设计为唯一索引等  
经常再查询条件出现的属性，经常作为聚集函数的参数的属性，经常在连接操作的连接条件中出现的属性，可以建立索引  
##### 2. hash索引存取方法的选择
如果一个关系的属性主要出现在等值连接条件或者等值比较选择条件中，且关系的大小可预知或者大小动态改变，但是系统提供了动态hash存取方法，就可以选择hash存取方法
##### 3. 聚簇存取方法的选择
聚簇：把某个或者某些属性上具有相同值的元组集中存放在连续的物理块中  
该属性或属性组称为聚簇码  
选择聚簇存取方法：确定需要建立多少个聚簇，每个聚簇中包含哪些关系  
步骤：  
1. 建立候选聚簇
    - 经产进行连接操作的关系
    - 一个关系的一组属性经常出现在相等比较条件之中
    - 一个关系上的一个或者一组属性上的值重复率很高
2. 检查候选聚簇中的关系，取消其中不必要的关系
    - 从聚簇中删除经常进行全表扫描的关系
    - 从聚簇中删除更新操作远多于连接操作的关系
    - 不同的聚簇中可能包含相同的关系，这是需要进行比较  

##### 7.5.3 确定数据库的存储结构
确定数据库的存储结构主要指确定数据的存放位置和存储结构，包括确定关系、索引、聚簇、日志、备份等的存储安排和存储结构，确定系统配置等  
###### 1. 确定数据的存放位置
为提高系统性能，应该将数据的易变部分与稳定部分、经常存取部分和存取频率较低部分分开存放  
###### 2. 确定系统配置
就是改变系统配置变量和存储分配参数
#### 7.5.4 评价物理结构
完全依赖于主要是从定量估算各种方案的存储空间、存取时间和维护代价入手，对估算结果进行权衡  

### 7.6 数据库的实施和维护
数据库实施阶段：完成数据库的物理设计之后将数据库逻辑设计结果和物理设计结果版携程DBMS可以接受的源代码，再经过调试产生目标模式。之后就可以组织数据入库了  

#### 7.6.1 数据的载入和应用程序的调试
数据库实施阶段包含两个重要的工作：  
- 数据的载入
    - 将各类源数据从各个局部应用中抽取出来，输入计算机，在分类转换，最后综合成符合新设计的数据库结构的形式，输入数据库  
    - 为了提高数据输入工作的效率和质量，应该针对具体的环境设计一个数据录入子系统
- 应用程序的编码和调试
    - **数据库应用程序的设计应该与数据库设计同时进行**，因此组织数据入库的时候还要再调试应用程序

##### 7.6.2 数据库的试运行
数据库的试运行：在原有系统的数据由一小部分输入数据库之后，就可以开始对数据库系统进行联合调试了  
这一阶段的任务：  
1. 实际运行数据库应用程序，执行对数据库的各种操作，测试应用程序的功能  
2. 测试系统的性能指标，分析其是否达到应用目标
    - 在机型物理设计是虽然初步确定了系统的物理参数值，当只是近似估计，和实际情况有所差距
    - 如果测试的结果与目标不符，就返回物理设计阶段甚至逻辑设计阶段

###### 注意：
1. 由于组织数据入库十分费时费力，一旦修改数据库又要重新入库，**先输入小批量数据做调试用，待试运行基本合格之后再大批量输入数据，逐步增加数据量，逐步完成运行评价**
2. 在试运行阶段，**要做好数据库的转储和恢复操作**  

#### 7.6.3 数据库的运行和维护
数据库是运行合格之后，数据库开发工作就基本完成了，数据库可以投入正式运行。在数据库运行阶段DBA要完成数据库的维护工作  
数据库的维护工作主要包括以下几方面：  
1. 数据库的转储和恢复
2. 数据库的安全性、完整性控制
3. 数据库性能的监督，分析和改造
4. **数据库的重组织和重构造**
##### 数据库的重组织和重构造
###### 重组织
- 原因：数据库运行一段时间之后，由于记录不断增删改，将会是数据库的物理存储情况变坏，降低数据的存储效率，是数据库性能下降
- 内容：按照原设计要求，重新安排存储位置，回收垃圾，减少指针链等，提高系统性能
###### 重构造
- 指部分修改数据库的模式和内模式
- 原因：由于数据库应用环境发生变化，增加了新的应用或新的个体，取消了某些应用，部分实体和实体间的联系发生了变化等，使原有数据库设计无法满足新的需求，需要调整数据库的模式和内模式  
- 重构是有限的，只能做部分修改  

区别：数据库的重组织并不修改原设计的逻辑和物理结构，而数据库的重构造则不同，它是指部分修改数据库的模式和内模式  
